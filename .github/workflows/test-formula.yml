name: Test Homebrew Formula

on:
  workflow_run:
    workflows: ["Release"]
    types:
      - completed

jobs:
  test-formula:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest

    steps:
      - name: 🧪 Install Homebrew
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential curl file git
          bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
          echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> $GITHUB_ENV
          eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"

      - name: 🍺 Tap homebrew-tap
        run: |
          brew tap karle0wne/tap

      - name: 📦 Install context-for-ai
        run: |
          brew install karle0wne/tap/context-for-ai

      - name: ✅ Verify context-for-ai --version
        run: |
          context-for-ai --version
